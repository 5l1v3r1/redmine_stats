<%= javascript_include_tag 'Chart.min.js', :plugin => 'redmine_stats' %>



<div class="splitcontentleft">

<div>
<h3><%= l(:issue_activity) %></h3>
<canvas id="chart_left"  width="400" height="200"></canvas>
</div>
<br>
<h3><%=l(:field_tracker)%></h3>
<%= render :partial => 'simple', :locals => { :data => @issues_by_tracker, :field_name => "tracker_id", :rows => @trackers } %>
<br />
<h3><%=l(:field_assigned_to)%></h3>
<%= render :partial => 'simple', :locals => { :data => @issues_by_assigned_to, :field_name => "assigned_to_id", :rows => @assignees } %>
<br />
</div>


<div class="splitcontentright">
<h3><%=l(:field_priority)%></h3>
<%= render :partial => 'simple', :locals => { :data => @issues_by_priority, :field_name => "priority_id", :rows => @priorities } %>
<br />
<div><canvas id="chart_right"  width="400" height="200"></canvas></div>
<h3><%=l(:field_author)%></h3>
<%= render :partial => 'simple', :locals => { :data => @issues_by_author, :field_name => "author_id", :rows => @authors } %>
<br />
</div>

<script>

			var labels_1 = <%= raw @issues_last_days[:dates].to_json %>;
			var lineChartData_1 = {
			labels : labels_1,
			datasets : [
				{
					label: "Closed Issues",
					fillColor : "#FF0000",
					strokeColor : "rgba(217,83,79,0.6)",
					pointColor : "rgba(201,48,44,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(220,220,220,1)",
					data : <%= raw @issues_last_days[:closed].to_json %>
				},
				{
					label: "Opened Issues",
					fillColor : "rgba(92,184,92,0.4)",
					strokeColor : "rgba(68,157,68,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(151,187,205,1)",
					data : <%= raw @issues_last_days[:created].to_json %>,
				},

			]};


			var data = {
		    labels: <%= raw @priorities.map{|p| p.name}.to_json %>,
		    datasets: [
		        {
		            label: "Closed Issues",
					fillColor : "#FF0000",
					strokeColor : "rgba(217,83,79,0.4)",
					pointColor : "rgba(201,48,44,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(220,220,220,1)",
		            data: <%= raw @priorities.map{|priority| 
		            	
		            	total = 0
		            	@issues_by_priority.each{|p| 
							total += p["total"] if p["closed"] == "f" and priority.id == p["priority_id"]
		            	}

		            	total

		            }.to_json %>
		        } ,
		        {
		            label: "Opened Issues",
					fillColor : "rgba(92,184,92,0.4)",
					strokeColor : "rgba(68,157,68,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(151,187,205,1)",
		            data: <%= raw @priorities.map{|priority| 
		            	
		            	total = 0
		            	@issues_by_priority.each{|p| 
							total += p["total"] if p["closed"] == "t" and priority.id == p["priority_id"]
		            	}

		            	total

		            }.to_json %>
		        }
		    ]};




	window.onload = function(){
		var ctx = document.getElementById("chart_left").getContext("2d");
		window.myLine = new Chart(ctx).Line(lineChartData_1, {
			responsive: false
		});

		var ctx = document.getElementById("chart_right").getContext("2d");
		window.myLine = new Chart(ctx).Radar(data, {
		    pointDot: false
		});
	}


</script>